# Spring

## Жизненный цикл бинов
1. Парсирование конфигурации и создание BeanDefinition. BeanDefinitionReader отвечает за считывание конфигураций.
2. Настройка BeanDefinitions при помощи BeanPostProcessor.
Интерфейс BeanPostProcessor позволяет настраивать бины до того, как они
попадут в IOC контейнер. Интерфейс несет в себе два метода: postProcessBeforeInitialization(Object bean, String beanName) 
и postProcessAfterInitialization(Object bean, String beanName). 
У обоих методов параметры абсолютно одинаковые. Разница только в порядке их вызова. Первый вызывается до 
init-метода, второй - после. 
Понадобится эта функция может в случаях, когда для изменяемый бин требуется для создания других бинов.
Например, когда нужно создать кастомную аннотацию. Также можно использовать BeanPostProcessor для 
чтения property-файлов и получения из них свойства бинов.
3. Создание бинов и перемещение их в контейнер. BeanDefinitions при этом представляют собой Map, в которой в качестве ключа выступает id бина, а в качестве
значения - его декларация. К декларации бина относится:
- Имя класса с пакетом.
- Имя бина, destroy, init-методы.
- Желаемое поведение (scope, обратные вызовы жизненного цикла и т.д.)ю
- Зависимости (ссылки на другие бины).

## Как разрешить циклические зависимости
Циклическая зависимость - когда бин А зависит от бина Б, но бин Б в то же
время зависит от бита А. Спринг не может решить, какой бин создавать первым
и выбрасывает _BeanCurrentlyInCreationException_.
Способы решения:
- Сделать рефакторинг: обязанности должны быть четко разделены, а иерархия соблюдаться.
- Использовать @Lazy для одного из компонентов. Тогда, вместо полной инициализации,
  Spring создаст прокси, чтобы заинжектить его в другой класс. И бин будет создан в первый раз
  только тогда, когда понадобится.
- Использовать для внедрения зависимости сеттеры или поля вместо конструкторов. В этом случае
  зависимости будут созданы по мере необходимости.
- Использовать @PostConstruct.

## Способы определения конфигурации и компонентов
В Spring доступны следующие виды конфигурации:
1. На основе xml-файлов.
2. Java-конфигурации. Чтобы создать класс с конфигурацией на основе Java-кода, нужно аннотировать его с помощью 
@Configuration.
3. Groovy-конфигурация.

## Spring scope
Скоуп – реализация паттерна «стратегия» для фабрик бинов, инструкция по созданию бизнес-объектов.
- Singleton - объект создается однажды, при последующих внедрениях переиспользуется. 
Полезен для большинства случаев: различные сервисы, объекты без состояния, неизменяемые объекты. 
Стоит заметить, это не класс-синглтон: при объявлении двух бинов одного класса их экземпляров будет два. 
Это скоуп по умолчанию.
- Prototype - при каждом внедрении фабрика бинов создает новый объект. Нужен для изменяемых бинов с состоянием.
- request
- session
- application
- websocket

## Что случится, если в scope Singleton внедрить Prototype и как это можно сделать? 
Если просто добавить к определению бина аннотацию @Scope(SCOPE_PROTOTYPE), и использовать этот бин в синглтоне 
через аннотацию @Autowired – будет создан только один объект. Потому что синглтон создается только однажды, 
и обращение к прототипу случится тоже однажды при его создании (при внедрении зависимости). Лучше использовать 
следующие варианты:
- @Lookup
- Фабрика для создания экземпляров prototype-бинов
- ProxyMod = ScopedProxyMode.TARGET_CLASS

## Особенности бинов со scope prototype и singleton
- Бин с областью Singleton создается сразу после поднятия контекста. Prototype создается в момент, когда он нужен, и не хранится в IOC
контейнере. Соответственно и метод destroy у него будет вызвать нельзя. 
- Singleton - потокобезопасный, так кк гарантирует что один и тот же экземпляр будет вызываться только в 1 потоке. Бины со scope prorotype 
в многопоточности лучше не использовать. 
-  С областью prototype ваш бин будет проходить через все BeanPostProcessor-ы,
что может значительно ударить по производительности.

## Что такое профили? Какие у них причины использования?
При использовании Java-конфигурации вы можете использовать аннотацию @Profile.
Она позволяет использовать разные настройки для Spring в зависимости от указанного профиля.
Ее можно ставить на @Configuration и Component классы, а также на Bean методы.

## Как внедрить простые значения в свойства в Spring?
Для этого можно использовать аннотацию @Value.
Такие значения можно получать из property файлов, из бинов, и т.п.

Про цикл бинов можно подробнее почитать и посмотреть здесь: https://habr.com/ru/post/222579/
https://www.youtube.com/watch?v=BmBr5diz8WA&ab_channel=JPoint%2CJokerиJUGru
https://www.youtube.com/watch?v=cou_qomYLNU&t=2s&ab_channel=JPoint%2CJokerиJUGru
Подготовка к Spring Professional Certification. Контейнер, IoC, бины: https://habr.com/ru/post/470305/
